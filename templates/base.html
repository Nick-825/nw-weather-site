<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0f172a">
  <title>{{ title or "Погода, Новости и Курсы валют" }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark; --safe-inset: env(safe-area-inset-bottom, 0px); }
    html { scroll-behavior: smooth; }

    /* ===== Улучшенные анимации погоды (слои, прозрачности, параллакс, мягкое 3D) ===== */
    @keyframes sunRays   { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
    @keyframes cloudMain { 0%,100%{transform:translateX(-8%)} 50%{transform:translateX(8%)} }
    @keyframes cloudSub  { 0%,100%{transform:translateX(10%)} 50%{transform:translateX(-10%)} }
    @keyframes rainDrop  { 0%{transform:translateY(-30%);opacity:0} 20%{opacity:.9} 100%{transform:translateY(110%);opacity:0} }
    @keyframes snowFall  { 0%{transform:translate(-10%,-20%);opacity:0} 40%{opacity:.95} 100%{transform:translate(10%,110%);opacity:0} }
    @keyframes fogSlide  { 0%{transform:translateX(-12%)} 50%{transform:translateX(12%)} 100%{transform:translateX(-12%)} }
    @keyframes stormFlash{ 0%,100%{opacity:.3} 45%{opacity:.1} 50%{opacity:.95} 55%{opacity:.2} }
    @keyframes calmPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.05)} }

    .wiggle { animation: calmPulse 2.5s ease-in-out infinite; transform-origin:center; display:inline-block; }
    .mini-badge { font-size: 11px; line-height: 1.1; word-break: break-word; }

    .weather-icon{
      position: relative; display:inline-flex; align-items:center; justify-content:center; line-height:1;
      perspective: 600px; /* лёгкий 3D */
      text-shadow: 0 2px 8px rgba(0,0,0,.35);
    }
    .weather-icon::after, .weather-icon::before { pointer-events:none; content:""; position:absolute; }

    /* Солнце */
    .weather-icon.sunny::after {
      inset:-32%; border-radius:9999px; border:2px solid rgba(250,204,21,.45);
      box-shadow:
        0 0 20px rgba(250,204,21,.35),
        inset 0 0 30px rgba(250,204,21,.2);
      animation:sunRays 12s linear infinite;
      transform: translateZ(12px);
    }

    /* Переменная облачность — два слоя облаков + параллакс */
    .weather-icon.partly::before,
    .weather-icon.cloudy::before{
      bottom:-6%; width:200%; height:70%; border-radius:9999px;
      background:radial-gradient(65% 65% at 30% 45%, rgba(241,245,249,.85) 0%, rgba(148,163,184,.25) 60%, transparent 100%);
      filter: blur(1.2px);
      animation:cloudMain 9s ease-in-out infinite;
      transform: translateZ(6px);
    }
    .weather-icon.partly::after,
    .weather-icon.cloudy::after{
      bottom:-10%; width:170%; height:60%; border-radius:9999px;
      background:radial-gradient(60% 60% at 60% 55%, rgba(203,213,225,.65) 0%, rgba(100,116,139,.25) 60%, transparent 100%);
      filter: blur(1px);
      animation:cloudSub 13s ease-in-out infinite;
      transform: translateZ(1px);
      opacity:.9;
    }

    /* Дождь / ледяной дождь — прозрачные струйки с бликами */
    .weather-icon.rainy::after, .weather-icon.icy-rain::after{
      bottom:-22%; width:6px; height:20px; border-radius:9999px;
      background:linear-gradient(to bottom, rgba(56,189,248,.85) 0%, rgba(14,165,233,0) 100%);
      animation:rainDrop .9s linear infinite;
      box-shadow:
        -12px 2px 0 rgba(56,189,248,.55),
        8px 8px 0 rgba(14,165,233,.5),
        0 16px 0 rgba(56,189,248,.35);
      transform: translateZ(14px);
      opacity:.9;
    }
    .weather-icon.icy-rain::after{
      background:linear-gradient(to bottom, rgba(191,219,254,.9) 0%, rgba(59,130,246,0) 100%);
      box-shadow:
        -12px 2px 0 rgba(191,219,254,.55),
        8px 8px 0 rgba(147,197,253,.5),
        0 16px 0 rgba(191,219,254,.35);
    }

    /* Снег */
    .weather-icon.snowy::after{
      bottom:-26%; width:7px; height:7px; border-radius:9999px; background:rgba(241,245,249,.95);
      box-shadow:
        -14px -6px 0 rgba(241,245,249,.9),
        6px 0 0 rgba(226,232,240,.85),
        -6px 10px 0 rgba(203,213,225,.85),
        12px -10px 0 rgba(226,232,240,.75);
      animation:snowFall 1.8s linear infinite;
      transform: translateZ(10px);
    }

    /* Туман */
    .weather-icon.foggy::after{
      bottom:-8%; width:210%; height:58%; border-radius:9999px;
      background:linear-gradient(90deg, rgba(148,163,184,.15), rgba(148,163,184,.4), rgba(148,163,184,.15));
      animation:fogSlide 7s ease-in-out infinite;
      filter: blur(3px);
      transform: translateZ(4px);
    }

    /* Гроза */
    .weather-icon.stormy::after{
      bottom:-22%; width:16px; height:30px;
      background:linear-gradient(135deg, rgba(250,204,21,.95), rgba(251,191,36,.65), rgba(249,115,22,.2));
      clip-path:polygon(50% 0, 70% 45%, 44% 45%, 66% 100%, 30% 56%, 54% 56%);
      animation:stormFlash 1.7s ease-in-out infinite;
      box-shadow:0 0 14px rgba(253,224,71,.5);
      transform: translateZ(18px) rotateX(6deg);
    }

    .weather-icon.calm { animation:calmPulse 3s ease-in-out infinite; }
  </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
  <header class="sticky top-0 z-40 bg-slate-950/95 backdrop-blur supports-[backdrop-filter]:bg-slate-950/80 border-b border-white/5">
    <div class="mx-auto flex w-full max-w-6xl items-center justify-between gap-4 px-4 py-3 sm:px-6">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 bg-yellow-400/90 rounded-full grid place-items-center text-slate-900 font-bold wiggle">☀️</div>
        <h1 class="font-bold text-lg sm:text-xl leading-tight">Погода • Новости • Курсы валют</h1>
      </div>
      <button id="mobile-menu-button" class="inline-flex items-center justify-center rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm font-medium text-white transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40 md:hidden" aria-expanded="false" aria-controls="mobile-menu">
        <span class="sr-only">Открыть меню</span>
        <svg id="icon-menu" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>
        <svg id="icon-close" xmlns="http://www.w3.org/2000/svg" class="hidden h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
      </button>
      <nav class="hidden md:flex gap-6 text-sm text-slate-200/80">
        <a href="/" class="transition hover:text-white">Главная</a>
        <a href="/rates" class="transition hover:text-white">Курсы валют</a>
        <a href="/news" class="transition hover:text-white">Новости</a>
        <a href="/weather" class="transition hover:text-white">Поиск местоположения</a>
        <a href="/weather/7days" class="transition hover:text-white">Погода на 7 дней</a>
      </nav>
    </div>
    <nav id="mobile-menu" class="hidden flex-col gap-2 border-t border-white/10 px-4 pb-4 text-sm text-slate-100 md:hidden">
      <a href="/" class="rounded-xl bg-white/5 px-4 py-2 transition hover:bg-white/10">Главная</a>
      <a href="/rates" class="rounded-xl bg-white/5 px-4 py-2 transition hover:bg-white/10">Курсы валют</a>
      <a href="/news" class="rounded-xl bg-white/5 px-4 py-2 transition hover:bg-white/10">Новости</a>
      <a href="/weather" class="rounded-xl bg-white/5 px-4 py-2 transition hover:bg-white/10">Поиск местоположения</a>
      <a href="/weather/7days" class="rounded-xl bg-white/5 px-4 py-2 transition hover:bg-white/10">Погода на 7 дней</a>
    </nav>
  </header>

  <main class="mx-auto flex w-full max-w-6xl flex-col gap-10 px-4 py-6 sm:px-6 sm:py-10">
    {% block content %}{% endblock %}
  </main>

  <footer class="px-4 pb-[calc(1.5rem+var(--safe-inset))] pt-6 text-center text-sm text-slate-500">
    © 2025 Погода от
    <a href="https://t.me/weatherinversesSPb" target="_blank" rel="noopener" class="text-cyan-400 hover:text-cyan-300 font-semibold underline underline-offset-4">Васька&nbsp;Невский</a>
  </footer>

  <script>
    (function () {
      const button = document.getElementById('mobile-menu-button');
      const menu = document.getElementById('mobile-menu');
      const iconMenu = document.getElementById('icon-menu');
      const iconClose = document.getElementById('icon-close');
      if (!button || !menu) return;
      button.addEventListener('click', function () {
        const isHidden = menu.classList.toggle('hidden');
        button.setAttribute('aria-expanded', String(!isHidden));
        if (iconMenu && iconClose) { iconMenu.classList.toggle('hidden'); iconClose.classList.toggle('hidden'); }
      });
      menu.querySelectorAll('a').forEach(function (link) {
        link.addEventListener('click', function () {
          if (menu.classList.contains('hidden')) return;
          menu.classList.add('hidden');
          button.setAttribute('aria-expanded', 'false');
          if (iconMenu && iconClose && iconMenu.classList.contains('hidden')) {
            iconMenu.classList.remove('hidden'); iconClose.classList.add('hidden');
          }
        });
      });
    })();
  </script>
</body>
</html>
