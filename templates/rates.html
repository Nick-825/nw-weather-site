{% extends "base.html" %}
{% block title %}–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç{% endblock %}
{% block content %}
<h2 style="margin:0 0 12px 0">–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç</h2>

<div style="display:grid;gap:24px;max-width:1100px">
  <!-- –§–∏–∞—Ç -->
  <section class="glass" style="padding:16px">
    <h3 style="margin-top:0">–í–∞–ª—é—Ç—ã –¶–ë –†–§</h3>
    <div style="position:relative">
      <input id="q-fiat" type="text" placeholder="USD, EUR, —Ñ—É–Ω—Ç‚Ä¶"
             style="width:100%;border-radius:14px;border:1px solid rgba(255,255,255,.1);background:#0f172a;color:#fff;padding:12px 14px;outline:none" autocomplete="off">
      <div id="suggest-fiat" class="sr-only" style="position:absolute;left:0;right:0;margin-top:8px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:#0b1220;z-index:20"></div>
    </div>
    <div id="meta-fiat" style="margin-top:6px;color:#9fb0c3;font-size:12px"></div>
    <div id="list-fiat" style="margin-top:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px"></div>
  </section>

  <!-- –ö—Ä–∏–ø—Ç–æ -->
  <section class="glass" style="padding:16px">
    <h3 style="margin-top:0">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã</h3>
    <div style="position:relative">
      <input id="q-crypto" type="text" placeholder="BTC, TON, ETH‚Ä¶"
             style="width:100%;border-radius:14px;border:1px solid rgba(255,255,255,.1);background:#0f172a;color:#fff;padding:12px 14px;outline:none" autocomplete="off">
      <div id="suggest-crypto" class="sr-only" style="position:absolute;left:0;right:0;margin-top:8px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:#0b1220;z-index:20"></div>
    </div>
    <div id="meta-crypto" style="margin-top:6px;color:#9fb0c3;font-size:12px"></div>
    <div id="list-crypto" style="margin-top:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px"></div>
  </section>
</div>
{% endblock %}

{% block scripts %}
<script>
(function(){
  const FALLBACK = {{ {
    "USD":{"emoji":"üá∫üá∏","symbol":"$"}, "EUR":{"emoji":"üá™üá∫","symbol":"‚Ç¨"}, "GBP":{"emoji":"üá¨üáß","symbol":"¬£"},
    "CNY":{"emoji":"üá®üá≥","symbol":"¬•"}, "JPY":{"emoji":"üáØüáµ","symbol":"¬•"}, "TRY":{"emoji":"üáπüá∑","symbol":"‚Ç∫"},
    "KZT":{"emoji":"üá∞üáø","symbol":"‚Ç∏"}, "UAH":{"emoji":"üá∫üá¶","symbol":"‚Ç¥"}, "AED":{"emoji":"üá¶üá™","symbol":"ÿØ.ÿ•"},
    "BYN":{"emoji":"üáßüáæ","symbol":"Br"}, "AMD":{"emoji":"üá¶üá≤","symbol":"÷è"}, "AZN":{"emoji":"üá¶üáø","symbol":"‚Çº"},
    "EGP":{"emoji":"üá™üá¨","symbol":"E¬£"}, "CDF":{"emoji":"üá®üá©","symbol":"FC"}
  }|tojson }};
  const CRYPTO_EMOJI = {"BTC":"‚Çø","ETH":"Œû","LTC":"≈Å","XMR":"…±","XRP":"‚úï","TON":"üßø","USDT":"‚ÇÆ","BNB":"‚í∑"};

  const applyFallback = (x) => {
    const code = (x.code||'').toUpperCase();
    if (!x.emoji && FALLBACK[code]?.emoji) x.emoji = FALLBACK[code].emoji;
    if (!x.symbol && (FALLBACK[code]?.symbol || CRYPTO_EMOJI[code])) x.symbol = FALLBACK[code]?.symbol || CRYPTO_EMOJI[code];
    return x;
  };

  const card = (x)=>{
    const pos = typeof x.change_percent==='number' ? x.change_percent>=0 : (typeof x.change==='number' ? x.change>=0 : null);
    const delta = (typeof x.change_percent==='number') ? `${pos?'‚ñ≤':'‚ñº'} ${Math.abs(x.change_percent).toFixed(2)}%`
                : (typeof x.change==='number')        ? `${pos?'‚ñ≤':'‚ñº'} ${Math.abs(x.change).toFixed(4)}` : '';
    const badge = delta ? `<div style="font-size:13px;font-weight:600;color:${pos?'#86efac':'#fecaca'}">${delta}</div>` : '';
    return `
      <article class="glass" style="padding:14px">
        <div style="display:flex;gap:12px;align-items:center">
          <div style="display:grid;place-items:center;width:56px;height:56px;border-radius:14px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);font
